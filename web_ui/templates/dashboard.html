{% extends "base.html" %}

{% block content %}

<div class="dashboard-grid">

    <div class="panel" style="grid-column: span 1;">
        <div class="panel-header">
            <span>Network Health Overview</span>
            <i class="fa-solid fa-ellipsis-vertical"></i>
        </div>
        <div class="panel-body">
            <div style="margin-bottom: 10px; font-size: 11px; color: var(--text-muted);">
                DEVICE STATUS MATRIX
            </div>
            <div class="honeycomb-grid">
                {% for d in devices %}
                    <div class="hex {% if d.state == 'UP' %}good{% else %}crit{% endif %}"
                         title="{{ d.name }} - {{ d.ip }}">
                    </div>
                {% endfor %}
                {% for i in range(20) %}
                    <div class="hex" style="opacity: 0.3;"></div>
                {% endfor %}
            </div>

            <div style="margin-top: 20px; display:flex; gap: 15px; font-size: 11px;">
                <div style="display:flex; align-items:center; gap:5px;"><div class="status-dot" style="background:var(--color-crit)"></div> CRIT</div>
                <div style="display:flex; align-items:center; gap:5px;"><div class="status-dot" style="background:var(--color-major)"></div> MAJOR</div>
                <div style="display:flex; align-items:center; gap:5px;"><div class="status-dot" style="background:var(--color-good)"></div> GOOD</div>
            </div>
        </div>
    </div>

    <div class="panel" style="grid-column: span 1;">
        <div class="panel-header">Interface Availability</div>
        <div class="panel-body" style="display:flex; align-items:center; justify-content:center;">
            <div style="height: 180px; width: 180px;">
                <canvas id="availabilityChart"></canvas>
            </div>
            <div style="position:absolute; text-align:center;">
                <div style="font-size: 24px; font-weight:bold;">{{ total }}</div>
                <div style="font-size: 10px; color:var(--text-muted);">TOTAL</div>
            </div>
        </div>
    </div>

    <div class="panel" style="grid-column: span 2;">
        <div class="panel-header">Alert Count</div>
        <div class="panel-body" style="display:flex; align-items:center; justify-content:space-around;">
            <div class="alert-circle" style="border-color: var(--color-crit); color: var(--color-crit);">
                <h2>{{ down }}</h2><span>DOWN</span>
            </div>
            <div class="alert-circle" style="border-color: var(--color-major); color: var(--color-major);">
                <h2>0</h2><span>CRIT</span>
            </div>
            <div class="alert-circle" style="border-color: var(--color-warn); color: var(--color-warn);">
                <h2>0</h2><span>WARN</span>
            </div>
            <div class="alert-circle" style="border-color: var(--border); color: var(--text-muted);">
                <h2>0</h2><span>INFO</span>
            </div>
        </div>
    </div>

</div>

<div class="dashboard-grid" style="margin-top: 15px;">

    <div class="panel" style="grid-column: span 2;">
        <div class="panel-header">
            <span>Top Network Monitor by Latency</span>
            <i class="fa-solid fa-expand"></i>
        </div>
        <div class="panel-body" style="padding:0;">
            <table>
                <thead>
                    <tr>
                        <th>MONITOR</th>
                        <th>LATENCY</th>
                        <th>STATUS</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in devices %}
                    <tr>
                        <td style="color: var(--color-blue);">{{ d.name }} <br><span style="color:var(--text-muted); font-size:10px;">{{ d.ip }}</span></td>
                        <td>
                            <span id="rtt_{{ d.id }}" style="font-family:monospace;">-- ms</span>
                        </td>
                        <td>
                            {% if d.state == 'UP' %}
                                <span style="color:var(--color-good);">● Online</span>
                            {% else %}
                                <span style="color:var(--color-crit);">● Offline</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="panel" style="grid-column: span 2;">
        <div class="panel-header">Network Flow / Volume</div>
        <div class="panel-body">
            <canvas id="flowChart" style="height: 100%; width: 100%;"></canvas>
        </div>
    </div>

</div>

<script>
    // --- 1. DONUT CHART CONFIG ---
    const ctxAvail = document.getElementById('availabilityChart').getContext('2d');
    new Chart(ctxAvail, {
        type: 'doughnut',
        data: {
            labels: ['UP', 'DOWN'],
            datasets: [{
                data: [{{ up }}, {{ down }}],
                backgroundColor: ['#2ecc71', '#ff4d4d'],
                borderWidth: 0,
                cutout: '85%'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } }
        }
    });

    // --- 2. FLOW CHART CONFIG (Fake Data for Visual) ---
    const ctxFlow = document.getElementById('flowChart').getContext('2d');
    new Chart(ctxFlow, {
        type: 'line',
        data: {
            labels: ['10:00', '10:05', '10:10', '10:15', '10:20', '10:25'],
            datasets: [{
                label: 'Inbound Traffic (Mb)',
                data: [12, 19, 3, 5, 2, 30],
                borderColor: '#0984e3',
                backgroundColor: 'rgba(9, 132, 227, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Outbound Traffic (Mb)',
                data: [5, 10, 15, 20, 10, 5],
                borderColor: '#feca57',
                borderDash: [5, 5],
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { grid: { color: '#2c3038' } },
                y: { grid: { color: '#2c3038' } }
            },
            plugins: { legend: { labels: { color: '#8b92a1' } } }
        }
    });
</script>

{% endblock %}